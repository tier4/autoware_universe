autoware_system_design_format: 0.3.0

# node information
name: GyroBiasEstimator.node

package:
  name: autoware_imu_corrector
  provider: autoware

launch:
  plugin: autoware::imu_corrector::GyroBiasEstimator
  executable: gyro_bias_estimator_node
  node_output: screen
  use_container: false

# interfaces
inputs:
  - name: imu_raw
    message_type: sensor_msgs/msg/Imu
  - name: odom
    message_type: nav_msgs/msg/Odometry
  - name: pose_ndt
    message_type: geometry_msgs/msg/PoseWithCovarianceStamped

outputs:
  - name: gyro_bias
    message_type: geometry_msgs/msg/Vector3Stamped
  - name: gyro_scale
    message_type: geometry_msgs/msg/Vector3Stamped
  - name: imu_scaled
    message_type: sensor_msgs/msg/Imu

# parameters
param_files:
  - name: imu_corrector_param_file
    default: config/imu_corrector.param.yaml
  - name: gyro_scale_estimator_param_file
    default: config/gyro_scale_estimator.param.yaml
  - name: gyro_bias_estimator_param_file
    default: config/gyro_bias_estimator.param.yaml

param_values: []

# processes
processes:
  - name: estimate_bias
    trigger_conditions:
      - and:
          - on_input: imu_raw
          - on_input: odom
    outcomes:
      - to_output: gyro_bias
      - to_output: gyro_scale
      - to_output: imu_scaled
  - name: estimate_scale
    trigger_conditions:
      - on_input: pose_ndt
    outcomes:
      - to_output: gyro_scale
