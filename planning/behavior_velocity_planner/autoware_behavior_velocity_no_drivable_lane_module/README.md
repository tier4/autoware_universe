## 走行可能車線なし

### 役割

このモジュールは、それらを参照する走行可能車線がない場合のパスに関連する部分の速度を計画します。

走行可能車線なしとは、車両がその車線で自律的に走行しては**ならない**動作設計領域 (ODD) 外の車線または複数の車線です。

車線は、SW および/または HW の技術的制限、ビジネス上の要件、安全上の考慮事項、それらの組み合わせなどの多くの理由により走行不能 (ODD 外) になる可能性があります。

走行可能車線なしの例

- 工事のため、意図的に道路が閉鎖されている場合
- 安全上の理由から、鉄道の下をくぐるアンダーパスの道路
- 技術的制限により車両が自律的に走行できない勾配/傾斜のある道路。他にも多くの例があります。

![no-drivable-lane-design.svg](./docs/no_drivable_lane_design.svg)

車線は、マップファイル内の関連車線の新しいタグ、`<tag k="no_drivable_lane" v="yes"/>` を追加することで無効になります。

このモジュールの目的は、走行不能車線に入る前に車両を停止させること (設定可能な停止マージンあり)、または車両が走行不能車線内で自律モードを開始した場合に車両を停止したままにすることです。次に、ドライバーに対して、運転タスクの責任を引き継ぐよう要求します (テイクオーバー要求/介入要求)。

### 起動タイミング

この機能は、ターゲットパスの走行車線 ID に走行不能車線のラベル (つまり、`no_drivable_lane` 属性が `yes` である) があるときに作動します。

### モジュールパラメータ

| パラメータ          | 型   | 説明                                            |
| ------------------ | ------ | ------------------------------------------------ |
| `stop_margin`      | double | スピーディーバンプ手前の自車位置までのマージン [m] |
| `print_debug_info` | bool   | デバッグ情報をプリントするかどうか             |

### 内部構造/アルゴリズム

- lanelet2マップからパスの`no_drivable_lane`属性を取得
- no drivable レーン状態ステートマシンは`INIT`状態で開始
- パスとno drivable レーンポリゴンとの間の交点を取得
- 次の場合にno drivable レーンに向かって`APPROACHING`状態を割り当て:
  - 自車前方から自己パスとno drivable レーンポリゴンとの最初の交点までの距離が`stop_margin`より大きい
- 次の場合に`INSIDE_NO_DRIVABLE_LANE`状態を割り当て:
  - 自パスの最初の点がno drivable レーンポリゴン内にある
  - 自車前方から自己パスとno drivable レーンポリゴンとの最初の交点までの距離が`stop_margin`より小さい
- 車両が完全に停止したら`STOPPED`状態を割り当て

![no_drivable_lane_scenarios.svg](./docs/no_drivable_lane_scenarios.svg)

### 将来の作業

- [Request to Intervene API](https://github.com/autowarefoundation/autoware/issues/3487)はまだ実装されていないため、`no_drivable_lane`により車両が停止した後、運転タスクの責任をドライバーに引き渡すために処理される予定
- 車両がno drivable レーン手前で停止したが、そのフットプリントの一部がno drivable レーンポリゴンと交差している場合を処理する

