## 残り距離と時間計算

### 役割

このパッケージは、ミッションの残り距離と所要時間の計算を提供することを目的としています。

### 起動とタイミング

- Autowareのミッションでルートが計画されると、計算が起動されます。
- 計算は`update_rate`パラメータに基づいて適時トリガーされます。

### モジュールパラメータ

| 名称          | 型     | デフォルト値 | 説明                          |
| ------------- | ------ | ------------ | ----------------------------- |
| `update_rate` | double | 10.0         | タイマーコールバック周期 [Hz] |

### 内部動作

#### 距離残計算

- 距離残計算は、`lanelet2`ルーティングAPIを使用して現在の自車位置と目標位置の間の最短残経路を取得することによって行われます。
- 距離残は、現在の車線と目標車線を除いた残最短経路の2D長さを合計することによって計算されます。
  - 現在の車線では、距離は現在の車両位置からその車線の終点までの距離で計算されます。
  - 目標車線では、距離は車線の開始位置からその車線内の目標位置までの距離で計算されます。
- 車線が1つだけ残っているとき、距離は現在の自車位置と目標位置の間の2D距離を取得することによって計算されます。
- ノードプロセスが終了しないように、現在の車線、目標車線、またはルーティンググラフが無効な場合を処理するためのチェックが追加されます。
  - そのようなケースでは、最後の有効な距離残と時間が保持されます。

#### 時間残計算

- 時間残は現在、最大速度制限を取得することによって、単純な運動方程式に依存しています。
- 距離残は、距離残を最大速度制限で割ることによって計算されます。
- 時間残計算には、最大速度制限が0より大きいことを確認するためのチェックが追加されます。これにより、ゼロによる除算や負の時間値の取得が防止されます。

### 今後の作業

- 残最短経路を検索するために定期的にグラフを探索するのではなく、より効率的な方法で距離残を計算します。
- より正確な時間残計算のために、より高度なモーションモデルに取り組みます。
