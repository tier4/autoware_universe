## 残距離と残り時間計算機能

### 役割

このパッケージは、ミッションの残距離と残り時間の計算を提供することを目的としています。

### 起動とタイミング

- Autowareのミッションに対するルートが計画されると計算が起動します。
- 計算は`update_rate`パラメータに基づいて適時にトリガーされます。

### モジュールパラメータ

| 名称          | タイプ   | デフォルト値 | 説明                 |
| ------------- | ------ | ------------- | --------------------------- |
| `update_rate` | double | 10.0          | タイマークールバック周期 [Hz] |

### 内部動作

#### 残り距離の計算

- 残り距離の計算は、現在の車両姿勢とゴール姿勢の間の最短経路の残りを `lanelet2` ルーティング API を使用して求めることで行われます。
- 残り距離は、残り最短経路の 2D 長を合計することで計算されますが、現在のレーンのレットとゴールのレーンのレットは除きます。
  - 現在のレーンのレットでは、距離は現在の車両位置からそのレーンのレットの終わりまで計算されます。
  - ゴールのレーンのレットでは、距離はそのレーンのレット内でのレーンのレットの開始位置からゴール姿勢まで計算されます。
- 残りレーンのレットが 1 つしかない場合は、距離は現在の車両姿勢とゴール姿勢の 2D 距離を取得することで計算されます。
- ノードプロセスが終了しないように、現在のレーンのレット、ゴールのレーンのレット、またはルーティンググラフが有効でない場合を処理するためのチェックが追加されました。
  - このような場合、最後に有効な残り距離と時間が維持されます。

#### 残り時間の計算

- 現在の残り時間は、最大速度制限を取得する単純な運動方程式によって決まります。
- 残り距離は、残り距離を最大速度制限で割ることで計算されます。
- 最大速度制限がゼロより大きいことを確認するためのチェックが残り時間の計算に追加されました。これによって、ゼロで除算したり、負の時間の値を取得したりすることが防止されます。

### 今後の作業

- グラフを定期的に検索して残り最短経路を求める以外の、残り距離計算のより効率的な方法を見つける。
- より正確な残り時間の計算のために、より高度な運動モデルを採用する。

