# Behavior Path Sampling Planner

警告: このモジュールは実験段階であり、実際の車両で適切にテストされていません。シミュレーションでのみ使用してください。

## 目的

このパッケージは、サンプリングベースプランニングを使用して、Behavior Path Planner用の走行可能経路を生成するノードを実装します。このパッケージは、[sampling_based_plannerモジュール](https://github.com/autowarefoundation/autoware.universe/tree/main/planning/sampling_based_planner)を大幅にベースとしています。

## 機能

このパッケージは次のことができます。

- 静的障害物を避けるためのスムーズな経路を作成します。
- (存在する場合)生成された経路がカスタマイズ可能なハード制約に確実に準拠します。
- 自車が目標車線に合流した後に成功状態に移行します。
- 以前生成した出力を再利用して、新しい代替経路を再サンプリングします。

速度は入力パスからそのまま取得されます。

## アルゴリズム

サンプリングベースプランニングは、3つの連続したステップに分解されます。

1. サンプリング: 候補経路が生成されます。
2. 剪定: 無効な候補は破棄されます。
3. 選択: 残りの有効な候補の中で最善の候補が選択されます。

### サンプリング

候補経路は、現在の自己状態とターゲット状態に基づいて生成されます。
現在、1つのサンプリングアルゴリズムが実装されています。フレネフレーム内の多項式です。

### 剪定

各候補経路の有効性は、一連のハード制約を使用してチェックされます。

- 衝突: 静的障害物との衝突がないことを確認します。
- 曲率: 滑らかな曲率を確保します。
- 走行可能エリア: 経路が走行可能エリア内に留まることを確認します。

### 選択

有効な候補経路の中で、_最善の_経路は、一連のソフト制約(つまり目的関数)を使用して決定されます。

- 曲率: よりスムーズな経路を優先します。
- 長さ: 残り経路長が長い経路を優先します。
- 側方偏差: 目標に近い経路を優先します。

各ソフト制約には重みが関連付けられており、優先順位を調整できます。

## 制限事項

フレネフレーム内の多項式で生成された候補の品質は、参照経路に大きく依存します。
参照経路がスムーズでない場合、生成された候補はおそらく運転不可能になります。

有効な経路が見つからない場合、現在では突然停止する経路になります。

このモジュールは、目標車線に迅速に収束する経路を生成することに問題があります。基本的に、すべての障害物を克服した後、モジュールは自車が目標車線に迅速に再収束する経路(つまり、平均側方偏差と最終側方偏差が小さい経路)を優先する必要があります。ただし、これは現在正しく機能していません。

## 今後の作業

このモジュールの可能な改善点を以下に示します。

- 動的な重み調整アルゴリズムの実装: シナリオに応じて重みを動的に変更する (つまり、すべての障害物を回避した後、曲率が小さく、平均横方向偏差が小さい経路を優先する)。

- コンピューティング時間を短縮し、より動的なソフト制約重み調整を行うために、複数目的最適化を実装する。[関連する出版物](https://ieeexplore.ieee.org/abstract/document/10180226)。

- 別のサンプル取得方法としてベジェ曲線を実装する。[sampling_based_plannerモジュール](https://github.com/autowarefoundation/autoware.universe/tree/main/planning/sampling_based_planner)を参照のこと。

- いくつかの他の動作経路モジュールを、サンプリングベース動作経路モジュールに置き換える可能性を調査する。

- このモジュールが成熟し、いくつかの制限点が解決されれば、実際のテストを実行する。

## その他の可能性

このモジュールは現在、静止障害物回避用の経路の作成を目的としています。ただし、サンプリングプランナの性質により、このモジュールを車線変更、動的回避、一般的な目標への到達など他のタスクに拡張または転用できます。適切な候補の剪定と適切なソフト制約重み調整を想定すれば、サンプリングプランニングアプローチを他の動作経路モジュールの代替として使用することは可能です。

