<launch>
  <!-- trajectory generator -->
  <group>
    <push-ros-namespace namespace="trajectory_generator"/>
    <!-- neural network based planning module -->
    <group>
      <push-ros-namespace namespace="neural_network_based_planner"/>
      <include file="$(find-pkg-share autoware_diffusion_planner)/launch/diffusion_planner.launch.xml">
        <arg name="diffusion_planner_param_path" value="$(var diffusion_planner_param_path)"/>
        <arg name="input_odometry" value="/localization/kinematic_state"/>
        <arg name="input_acceleration" value="/localization/acceleration"/>
        <arg name="input_route" value="/planning/mission_planning/route"/>
        <arg name="input_traffic_signals" value="/perception/traffic_light_recognition/traffic_signals"/>
        <arg name="input_tracked_objects" value="/perception/object_recognition/tracking/objects"/>
        <arg name="input_vector_map" value="/map/vector_map"/>
        <arg name="input_turn_indicators" value="/vehicle/status/turn_indicators_status"/>
        <arg name="output_trajectories" value="/planning/generator/diffusion_planner/candidate_trajectories"/>
        <arg name="output_turn_indicators" value="/planning/turn_indicators_cmd"/>
      </include>
      <include file="$(find-pkg-share autoware_trajectory_modifier)/launch/trajectory_modifier.launch.xml">
        <arg name="input_candidate_trajectories" value="/planning/generator/diffusion_planner/candidate_trajectories"/>
        <arg name="output_candidate_trajectories" value="/planning/generator/diffusion_planner/modified_candidate_trajectories"/>
        <arg name="input_odometry" value="/localization/kinematic_state"/>
        <arg name="input_acceleration" value="/localization/acceleration"/>
      </include>
      <include file="$(find-pkg-share autoware_trajectory_optimizer)/launch/trajectory_optimizer.launch.xml">
        <arg name="input_trajectories" value="/planning/generator/diffusion_planner/modified_candidate_trajectories"/>
        <arg name="output_traj" value="/planning/generator/trajectory_optimizer/debug/trajectory"/>
        <arg name="output_trajectories" value="/planning/generator/candidate_trajectories/debug"/>
      </include>
    </group>

    <!-- minimum rule-based planner -->
    <group>
      <push-ros-namespace namespace="minimum_rule_based_planner"/>
      <include file="$(find-pkg-share autoware_minimum_rule_based_planner)/launch/minimum_rule_based_planner.launch.xml">
        <arg name="input_route" value="/planning/mission_planning/route"/>
        <arg name="input_vector_map" value="/map/vector_map"/>
        <arg name="input_odometry" value="/localization/kinematic_state"/>
        <arg name="input_acceleration" value="/localization/acceleration"/>
        <arg name="input_objects" value="/perception/object_recognition/objects"/>
        <arg name="output_candidate_trajectories" value="/planning/generator/candidate_trajectories"/>
      </include>
    </group>
  </group>

  <!-- trajectory selector -->
  <group>
    <push-ros-namespace namespace="trajectory_selector"/>
    <include file="$(find-pkg-share autoware_trajectory_concatenator)/launch/trajectory_concatenator.launch.xml">
      <arg name="concatenator_input_trajectories" value="/planning/generator/candidate_trajectories"/>
      <arg name="concatenator_output_trajectories" value="/planning/generator/concatenated/candidate_trajectories"/>
    </include>
    <include file="$(find-pkg-share autoware_trajectory_safety_filter)/launch/trajectory_safety_filter.launch.xml">
      <arg name="input_trajectories" value="/planning/generator/concatenated/candidate_trajectories"/>
      <arg name="output_trajectories" value="/planning/trajectory_selector/safety_filter/candidate_trajectories"/>
      <arg name="input_vector_map" value="/map/vector_map"/>
      <arg name="input_odometry" value="/localization/kinematic_state"/>
      <arg name="input_objects" value="/perception/object_recognition/objects"/>
    </include>
    <include file="$(find-pkg-share autoware_trajectory_traffic_rule_filter)/launch/trajectory_traffic_rule_filter.launch.xml">
      <arg name="input_trajectories" value="/planning/trajectory_selector/safety_filter/candidate_trajectories"/>
      <arg name="output_trajectories" value="/planning/trajectory_selector/traffic_rule_filter/candidate_trajectories"/>
      <arg name="input_map" value="/map/vector_map"/>
      <arg name="input_traffic_signals" value="/perception/traffic_light_recognition/traffic_signals"/>
    </include>
    <include file="$(find-pkg-share autoware_trajectory_ranker)/launch/trajectory_ranker.launch.xml">
      <arg name="input_trajectories" value="/planning/trajectory_selector/traffic_rule_filter/candidate_trajectories"/>
      <arg name="output_trajectories" value="/planning/trajectory_selector/ranker/scored_trajectories"/>
      <arg name="input_route" value="/planning/mission_planning/route"/>
      <arg name="input_vector_map" value="/map/vector_map"/>
      <arg name="input_odometry" value="/localization/kinematic_state"/>
      <arg name="input_objects" value="/perception/object_recognition/objects"/>
    </include>
    <include file="$(find-pkg-share autoware_trajectory_adapter)/launch/trajectory_adapter.launch.xml">
      <arg name="input_trajectories" value="/planning/trajectory_selector/ranker/scored_trajectories"/>
      <arg name="output_trajectory" value="/planning/trajectory"/>
    </include>
  </group>
</launch>
