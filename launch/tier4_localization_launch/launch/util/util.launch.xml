<launch>
  <!-- topic -->
  <arg name="output/pointcloud" default="downsample/pointcloud" description="final output topic name"/>

  <!-- container -->
  <arg name="localization_pointcloud_container_name" default="/pointcloud_container" description="container name of main lidar used for localization"/>

  <!-- whether use intra-process -->
  <arg name="use_intra_process" default="true" description="use ROS 2 component container communication"/>

  <!-- crop_box_filter_measurement_range (agnocast standalone node) -->
  <node pkg="autoware_pointcloud_preprocessor" exec="agnocast_crop_box_filter_node" name="crop_box_filter_measurement_range">
    <param from="$(var ndt_scan_matcher/pointcloud_preprocessor/crop_box_filter_measurement_range_param_path)"/>
    <remap from="input" to="$(var input_pointcloud)"/>
    <remap from="output" to="measurement_range/pointcloud"/>
    <env name="LD_PRELOAD" value="/opt/ros/humble/lib/libagnocast_heaphook.so:$(env LD_PRELOAD '')"/>
  </node>

  <!-- voxel_grid_downsample_filter (agnocast standalone node) -->
  <node pkg="autoware_pointcloud_preprocessor" exec="agnocast_voxel_grid_downsample_filter_node" name="voxel_grid_downsample_filter">
    <param from="$(var ndt_scan_matcher/pointcloud_preprocessor/voxel_grid_downsample_filter_param_path)"/>
    <remap from="input" to="measurement_range/pointcloud"/>
    <remap from="output" to="voxel_grid_downsample/pointcloud"/>
    <env name="LD_PRELOAD" value="/opt/ros/humble/lib/libagnocast_heaphook.so:$(env LD_PRELOAD '')"/>
  </node>

  <!-- random_downsample_filter (agnocast standalone node) -->
  <node pkg="autoware_pointcloud_preprocessor" exec="agnocast_random_downsample_filter_node" name="random_downsample_filter">
    <param from="$(var ndt_scan_matcher/pointcloud_preprocessor/random_downsample_filter_param_path)"/>
    <remap from="input" to="voxel_grid_downsample/pointcloud"/>
    <remap from="output" to="$(var output/pointcloud)"/>
    <env name="LD_PRELOAD" value="/opt/ros/humble/lib/libagnocast_heaphook.so:$(env LD_PRELOAD '')"/>
  </node>
</launch>
