# topic_state_monitor

## 目的

このノードは、タイムアウトや低周波数などの異常について入力トピックを監視します。
トピック状態の結果は、診断として公開されます。

## 内部動作/アルゴリズム

トピック状態のタイプと対応する診断状態は次のとおりです。

| トピックのステータス | 診断ステータス | 説明 |
|---|---|---|
| `OK` | OK | トピックに異常なし |
| `NotReceived` | エラー | トピックがまだ受信されていない |
| `WarnRate` | 警告 | トピックの周波数が低下している |
| `ErrorRate` | エラー | トピックの周波数が大幅に低下している |
| `Timeout` | エラー | トピックのサブスクリプションが一定時間停止している |

## 入出力

### 入力

| 名前     | 種類     | 説明                       |
| -------- | -------- | --------------------------------- |
| 任意の名前 | 任意の種類 | 監視する対象トピックを購読する |

#### 自動運転ソフトウェア
[ドキュメントのURL]

### 概要

本ドキュメントは、Autoware自動運転ソフトウェアのアーキテクチャ、コンポーネント/モジュール、およびインタフェースに関する技術仕様を提供します。

### アーキテクチャ

Autowareアーキテクチャは、以下を含む3つの主要層で構成されています。

- **Perception:** センサデータから周囲環境を認識します。
- **Planning:** 自車の経路と速度を計画します。
- **Control:** 計画を実行し、車両を制御します。

### コンポーネント/モジュール

#### Perception

- **カメラ:** 画像データの取得と特徴抽出手順
- **LiDAR:** 3D点群データの取得と処理

#### Planning

- **Motion Planner:** 自車経路の生成
- **Behavior Planner:** 自車の行動の決定

#### Control

- **Longitudinal Controller:** 加速度と減速度の制御
- **Lateral Controller:** ステアリング角の制御

### インタフェース

各コンポーネント/モジュールは、ROSメッセージインタフェース를 사용합니다.

#### Perception

- **Camera:** `sensor_msgs/Image`
- **LiDAR:** `sensor_msgs/PointCloud2`

#### Planning

- **Motion Planner:** `nav_msgs/Path`
- **Behavior Planner:** `autoware_msgs/BehaviorCommand`

#### Control

- **Longitudinal Controller:** `std_msgs/Float64` (加速度/減速度)
- **Lateral Controller:** `std_msgs/Float64` (ステアリング角)

### その他の機能

- **Localization:** 自車位置の推定
- **Mapping:** 環境マップの作成
- **Visualization:** データの可視化とデバッグ

| 名称 | タイプ | 説明 |
|---|---|---|
| `/diagnostics` | `diagnostic_msgs/DiagnosticArray` | 診断出力 |

## パラメータ

### ノードパラメータ

| 名 | 種別 | デフォルト値 | 説明 |
|---|---|---|---|
| `トピック` | 文字列 | - | 目標トピックの名前 |
| `トピック種別` | 文字列 | - | 目標トピックの種別（トピックが変換でない場合に使用） |
| `フレーム ID` | 文字列 | - | 変換親のフレーム ID（トピックが変換の場合に使用） |
| `子のフレーム ID` | 文字列 | - | 変換子のフレーム ID（トピックが変換の場合に使用） |
| `トランジェントローカル` | ブール | false | トピックサブスクリプションの QoS ポリシー（トランジェントローカル / 揮発性） |
| `ベスト प्रयास` | ブール | false | トピックサブスクリプションの QoS ポリシー（ベストエフォート / 信頼性） |
| `診断名` | 文字列 | - | 診断の公開に使用される名前 |
| `更新レート` | 倍精度浮動小数点数 | 10.0 | タイマーコールバックの周期 [Hz] |

### コアパラメータ

| 名称          | 型   | デフォルト値 | 説明                                                                                                      |
| ------------- | ------ | ------------- | ---------------------------------------------------------------------------------------------------------- |
| `warn_rate`   | double | 0.5           | トピックレートがこの値より低い場合、トピックステータスが「WarnRate」になります                            |
| `error_rate`  | double | 0.1           | トピックレートがこの値より低い場合、トピックステータスが「ErrorRate」になります                           |
| `timeout`     | double | 1.0           | トピックサブスクリプションが「timeout」を超えて停止する場合、トピックステータスが「Timeout」になります |
| `window_size` | int    | 10            | 周波数の計算に使用されるターゲットトピックのウィンドウサイズ                                             |

## 仮定 / 既知の限界

TBD.

