<launch>
  <arg name="is_redundant" default="false"/>
  <arg name="config" default="$(find-pkg-share autoware_command_mode_decider)/config/default.param.yaml"/>
  <arg name="is_main_ecu" default="false"/>
  <let name="status_topic_name" value="/system/command_mode/status" if="$(var is_main_ecu)"/>
  <let name="status_topic_name" value="/sub/system/command_mode/status" unless="$(var is_main_ecu)"/>

  <group if="$(var is_redundant)">
    <node pkg="autoware_command_mode_decider" exec="command_mode_decider_redundancy_node">
      <param from="$(var config)"/>
      <remap from="~/command_mode/status" to="$(var status_topic_name)"/>
      <remap from="~/command_mode/request" to="/system/command_mode/request"/>
      <remap from="~/operation_mode/state" to="/system/operation_mode/state"/>
      <remap from="~/operation_mode/change_operation_mode" to="/system/operation_mode/change_operation_mode"/>
      <remap from="~/operation_mode/change_autoware_control" to="/system/operation_mode/change_autoware_control"/>
      <remap from="~/mrm/state" to="/system/fail_safe/mrm_state"/>
      <remap from="~/mrm/request" to="/system/fail_safe/mrm_request"/>
    </node>
  </group>

  <group unless="$(var is_redundant)">
    <node pkg="autoware_command_mode_decider" exec="command_mode_decider_node">
      <param from="$(var config)"/>
      <remap from="~/command_mode/status" to="/system/command_mode/status"/>
      <remap from="~/command_mode/request" to="/system/command_mode/request"/>
      <remap from="~/operation_mode/state" to="/system/operation_mode/state"/>
      <remap from="~/operation_mode/change_operation_mode" to="/system/operation_mode/change_operation_mode"/>
      <remap from="~/operation_mode/change_autoware_control" to="/system/operation_mode/change_autoware_control"/>
      <remap from="~/mrm/state" to="/system/fail_safe/mrm_state"/>
      <remap from="~/mrm/request" to="/system/fail_safe/mrm_request"/>
    </node>
  </group>
</launch>
